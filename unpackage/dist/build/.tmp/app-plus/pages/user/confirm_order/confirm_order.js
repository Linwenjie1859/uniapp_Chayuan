(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/user/confirm_order/confirm_order"],{"47ef":function(r,e,t){"use strict";t.r(e);var n=t("4cad"),o=t("c78d");for(var a in o)"default"!==a&&function(r){t.d(e,r,function(){return o[r]})}(a);t("7d36");var i,u=t("f0c5"),c=Object(u["a"])(o["default"],n["b"],n["c"],!1,null,"0574e5e7",null,!1,n["a"],i);e["default"]=c.exports},"4cad":function(r,e,t){"use strict";var n,o=function(){var r=this,e=r.$createElement;r._self._c},a=[];t.d(e,"b",function(){return o}),t.d(e,"c",function(){return a}),t.d(e,"a",function(){return n})},"7d36":function(r,e,t){"use strict";var n=t("aa2f"),o=t.n(n);o.a},aa2f:function(r,e,t){},bf19:function(r,e,t){"use strict";(function(r,n){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=a(t("a34a"));function a(r){return r&&r.__esModule?r:{default:r}}function i(r,e,t,n,o,a,i){try{var u=r[a](i),c=u.value}catch(s){return void t(s)}u.done?e(c):Promise.resolve(c).then(n,o)}function u(r){return function(){var e=this,t=arguments;return new Promise(function(n,o){var a=r.apply(e,t);function u(r){i(a,n,o,u,c,"next",r)}function c(r){i(a,n,o,u,c,"throw",r)}u(void 0)})}}function c(r){return f(r)||d(r)||s()}function s(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function d(r){if(Symbol.iterator in Object(r)||"[object Arguments]"===Object.prototype.toString.call(r))return Array.from(r)}function f(r){if(Array.isArray(r)){for(var e=0,t=new Array(r.length);e<r.length;e++)t[e]=r[e];return t}}var l={data:function(){return{orderId:"",payModalFlag:!1,array:[{coupon_title:"未选择",coupon_price:0}],currentCouponPrice:0,couponIndex:0,listId:"",cartInfo:[],defaultAddress:{city:"",detail:"",district:"",id:"",is_default:"",phone:"",province:"",real_name:""},createOrder:{addressId:"",couponId:"",userIntegral:"",mark:""},orderKey:"",mer_id:0,providerList:[]}},onLoad:function(e){var t=this;this.listId=e.listId,this.getAddressList(),this.getOrderInfo(),r.getProvider({service:"payment",success:function(r){n("log","payment success:"+JSON.stringify(r)," at pages\\user\\confirm_order\\confirm_order.vue:199");var e=[];r.provider.map(function(r){switch(r){case"alipay":e.push({name:"支付宝",id:r,loading:!1});break;case"wxpay":e.push({name:"微信",id:r,loading:!1});break;default:break}}),t.providerList=e},fail:function(r){n("log","获取支付通道失败：",r," at pages\\user\\confirm_order\\confirm_order.vue:224")}})},computed:{sumNum:function(){for(var r=0,e=0;e<this.cartInfo.length;e++)r+=parseInt(this.cartInfo[e].count_num);return r},sumPrice:function(){for(var r=0,e=0;e<this.cartInfo.length;e++)r+=this.cartInfo[e].count_price;return parseFloat(r+"")}},methods:{payMoney:function(){var e=this;e.basePost(e.U({c:"pay",a:"pay"}),{reqsn:e.orderId,sumPrice:e.sumPrice,paytype:"A03"},function(t){r.showToast({title:t.data.errmsg,icon:"none"}),e.hideOrOpenModal()},function(r){n("log",r," at pages\\user\\confirm_order\\confirm_order.vue:266")})},hideOrOpenModal:function(){this.payModalFlag=!1,r.redirectTo({url:"/pages/user/order_details/order_details?order_id="+this.orderId})},dealData:function(r){for(var e=0;e<r.length;e++)r[e]["coupon_price"]=parseFloat(r[e].coupon_price);return r},getCanUseCoupon:function(r){var e=this;e.baseGet(e.U({c:"coupons_api",a:"get_use_coupon_order",q:{totalPrice:r}}),function(r){e.array=[].concat(c(e.array),c(e.dealData(r.data)))},function(r){n("log",r," at pages\\user\\confirm_order\\confirm_order.vue:294")},!0)},getAddressList:function(){var r=this;r.basePost(r.U({c:"user_api",a:"user_default_address"}),{},function(e){r.defaultAddress=e.data},function(r){n("log",r," at pages\\user\\confirm_order\\confirm_order.vue:308")})},SortData:function(r){for(var e={},t=[],n=0;n<r.length;n++){var o=r[n];if(e[o.mer_id])for(var a=0;a<t.length;a++){var i=t[a];if(i.mer_id==o.mer_id){i.count_price+=o.productInfo.price*o.cart_num,i.count_num+=o.cart_num,i.data.push(o);break}}else t.push({count_price:o.productInfo.price*o.cart_num,count_num:o.cart_num,mer_id:o.mer_id,data:[o]}),e[o.mer_id]="Occupies a position"}return t},getOrderInfo:function(){var r=this;r.basePost(r.U({c:"auth_api",a:"confirm_order"}),{cartId:r.listId},function(e){r.cartInfo=r.SortData(e.data.cartInfo),r.orderKey=e.data.orderKey,r.getCanUseCoupon(r.sumPrice)},function(r){n("log",r," at pages\\user\\confirm_order\\confirm_order.vue:354")})},bindPickerChange:function(r){this.couponIndex=r.detail.value,this.sumPrice+=this.currentCouponPrice,this.sumPrice-=this.array[r.detail.value].coupon_price,this.currentCouponPrice=this.array[r.detail.value].coupon_price},address:function(){r.navigateTo({url:"/pages/user/admin_address/admin_address?clickFlag=1"})},settlement:function(){var r=this;r.basePost(r.U({c:"auth_api",a:"create_order"}),{mer_id:r.cartInfo[0].mer_id,key:r.orderKey,addressId:r.defaultAddress.id,couponId:r.array[r.couponIndex].id,userIntegral:r.createOrder.userIntegral,mark:r.createOrder.mark,type:r.open_address?2:1},function(e){r.orderId=e.data.result.orderId,r.payModalFlag=!0},function(r){n("log",r," at pages\\user\\confirm_order\\confirm_order.vue:398")})},requestPayment:function(){var e=u(o.default.mark(function e(t,a){var i,u=this;return o.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.providerList[a].loading=!0,e.next=3,this.getOrderInfo_uniapp(t.id);case 3:if(i=e.sent,n("log","得到订单信息",i," at pages\\user\\confirm_order\\confirm_order.vue:406"),200===i.statusCode){e.next=9;break}return n("log","获得订单信息失败",i," at pages\\user\\confirm_order\\confirm_order.vue:408"),r.showModal({content:"获得订单信息失败",showCancel:!1}),e.abrupt("return");case 9:r.requestPayment({provider:t.id,orderInfo:i.data,success:function(e){n("log","success",e," at pages\\user\\confirm_order\\confirm_order.vue:419"),r.showToast({title:"感谢您的赞助!"})},fail:function(e){n("log","fail",e," at pages\\user\\confirm_order\\confirm_order.vue:425"),r.showModal({content:"支付失败,原因为: "+e.errMsg,showCancel:!1})},complete:function(){u.providerList[a].loading=!1}});case 10:case"end":return e.stop()}},e,this)}));function t(r,t){return e.apply(this,arguments)}return t}(),getOrderInfo_uniapp:function(e){var t="";t=plus.runtime.appid;var o="https://demo.dcloud.net.cn/payment/?payid="+e+"&appid="+t+"&total=0.1";return n("log",o," at pages\\user\\confirm_order\\confirm_order.vue:442"),new Promise(function(e){r.request({url:o,success:function(r){e(r)},fail:function(r){e(r)}})})}}};e.default=l}).call(this,t("6e42")["default"],t("0de9")["default"])},c4b9:function(r,e,t){"use strict";(function(r){t("7a84"),t("921b");n(t("66fd"));var e=n(t("47ef"));function n(r){return r&&r.__esModule?r:{default:r}}r(e.default)}).call(this,t("6e42")["createPage"])},c78d:function(r,e,t){"use strict";t.r(e);var n=t("bf19"),o=t.n(n);for(var a in n)"default"!==a&&function(r){t.d(e,r,function(){return n[r]})}(a);e["default"]=o.a}},[["c4b9","common/runtime","common/vendor"]]]);