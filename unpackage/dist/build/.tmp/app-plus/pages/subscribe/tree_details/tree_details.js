(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/subscribe/tree_details/tree_details"],{"2bca":function(t,e,r){"use strict";r.r(e);var a=r("bbac"),n=r.n(a);for(var o in a)"default"!==o&&function(t){r.d(e,t,function(){return a[t]})}(o);e["default"]=n.a},"31fc":function(t,e,r){"use strict";r.r(e);var a=r("f2f9"),n=r("2bca");for(var o in n)"default"!==o&&function(t){r.d(e,t,function(){return n[t]})}(o);r("3fe2");var i,s=r("f0c5"),u=Object(s["a"])(n["default"],a["b"],a["c"],!1,null,"533d42c9",null,!1,a["a"],i);e["default"]=u.exports},"3fe2":function(t,e,r){"use strict";var a=r("8e41"),n=r.n(a);n.a},"8e41":function(t,e,r){},bbac:function(t,e,r){"use strict";(function(t,a){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=o(r("a34a"));function o(t){return t&&t.__esModule?t:{default:t}}function i(t,e,r,a,n,o,i){try{var s=t[o](i),u=s.value}catch(d){return void r(d)}s.done?e(u):Promise.resolve(u).then(a,n)}function s(t){return function(){var e=this,r=arguments;return new Promise(function(a,n){var o=t.apply(e,r);function s(t){i(o,a,n,s,u,"next",t)}function u(t){i(o,a,n,s,u,"throw",t)}s(void 0)})}}var u={data:function(){return{StatusAddNav:this.StatusAddNav,StatusAddHalfNav:this.StatusAddHalfNav,opacityNum:0,currentGoodsId:0,goodsInfo:{storeInfo:{open_address:""}},cartInfo:{},orderKey:"",defaultAddress:{},providerList:[],orderId:"",id:""}},onPageScroll:function(e){t("log",e," at pages\\subscribe\\tree_details\\tree_details.vue:77"),this.opacityNum=e.scrollTop>50?1:0},onLoad:function(e){var r=this;this.currentGoodsId=e.id,this.getTreeInfo(),a.getProvider({service:"payment",success:function(t){var e=[];t.provider.map(function(t){switch(t){case"alipay":e.push({name:"支付宝",id:t,loading:!1});break;case"wxpay":e.push({name:"微信",id:t,loading:!1});break;default:break}}),r.providerList=e},fail:function(e){t("log","获取支付通道失败：",e," at pages\\subscribe\\tree_details\\tree_details.vue:112")}})},methods:{updatePayStatus:function(){var e=this;e.baseGet(e.U({c:"store_api",a:"update_pay_status",q:{order_id:e.orderId,product_id:e.currentGoodsId,id:e.id}}),function(e){t("log",e," at pages\\subscribe\\tree_details\\tree_details.vue:132")},function(e){t("log",e," at pages\\subscribe\\tree_details\\tree_details.vue:135")},!0)},requestPayment:function(){var e=s(n.default.mark(function e(){var r,o=this;return n.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.providerList[0].loading=!0,e.next=3,this.getOrderInfo_uniapp(this.providerList[0].id);case 3:if(r=e.sent,200===r.statusCode){e.next=8;break}return t("log","获得订单信息失败",r," at pages\\subscribe\\tree_details\\tree_details.vue:145"),a.showModal({content:"获得订单信息失败",showCancel:!1}),e.abrupt("return");case 8:a.requestPayment({provider:this.providerList[0].id,orderInfo:r.data,success:function(t){a.showToast({title:"感谢您的赞助!"})},fail:function(t){a.showModal({content:"支付失败,原因为: "+t.errMsg,showCancel:!1})},complete:function(){o.providerList[1].loading=!1}});case 9:case"end":return e.stop()}},e,this)}));function r(){return e.apply(this,arguments)}return r}(),getOrderInfo_uniapp:function(t){var e="";e=plus.runtime.appid;var r="https://demo.dcloud.net.cn/payment/?payid="+t+"&appid="+e+"&total=0.1";return new Promise(function(t){a.request({url:r,success:function(e){t(e)},fail:function(e){t(e)}})})},SortData:function(t){for(var e={},r=[],a=0;a<t.length;a++){var n=t[a];if(e[n.mer_id])for(var o=0;o<r.length;o++){var i=r[o];if(i.mer_id==n.mer_id){i.count_price+=n.productInfo.price*n.cart_num,i.count_num+=n.cart_num,i.data.push(n);break}}else r.push({count_price:n.productInfo.price*n.cart_num,count_num:n.cart_num,mer_id:n.mer_id,data:[n]}),e[n.mer_id]="Occupies a position"}return r},settlement:function(){var e=this;e.basePost(e.U({c:"auth_api",a:"create_order"}),{mer_id:e.cartInfo[0].mer_id,key:e.orderKey,couponId:"",userIntegral:"",mark:"",type:2,product_id:e.cartInfo[0].data[0].productInfo.id},function(t){e.orderId=t.data.result.orderId,e.id=t.data.result.id;t.data.result.orderId,e.sumPrice;e.updatePayStatus(),e.requestPayment()},function(e){t("log",e," at pages\\subscribe\\tree_details\\tree_details.vue:249")})},getOrderInfo:function(e){var r=this;r.basePost(r.U({c:"auth_api",a:"confirm_order"}),{cartId:e},function(t){r.cartInfo=r.SortData(t.data.cartInfo),r.orderKey=t.data.orderKey,r.settlement()},function(e){t("log",e," at pages\\subscribe\\tree_details\\tree_details.vue:268")})},purchase:function(){var t=this;t.isLogin(),t.baseGet(t.U({c:"auth_api",a:"now_buy",q:{productId:t.goodsInfo.storeInfo.id,merId:t.goodsInfo.merInfo.id,cartNum:1}}),function(e){t.getOrderInfo(e.data.cartId)},function(e){-1!=e.msg.indexOf("该产品库存不足")&&t.Tips({title:e.msg})},!0)},getTreeInfo:function(){var e=this;e.baseGet(e.U({c:"store_api",a:"details",q:{id:e.currentGoodsId}}),function(r){e.goodsInfo=r.data,t("log",e.goodsInfo," at pages\\subscribe\\tree_details\\tree_details.vue:312")},function(e){t("log",e," at pages\\subscribe\\tree_details\\tree_details.vue:315")},!0)},navToBack:function(){a.navigateBack({delta:1})}}};e.default=u}).call(this,r("0de9")["default"],r("6e42")["default"])},cbd8:function(t,e,r){"use strict";(function(t){r("7a84"),r("921b");a(r("66fd"));var e=a(r("31fc"));function a(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,r("6e42")["createPage"])},f2f9:function(t,e,r){"use strict";var a,n=function(){var t=this,e=t.$createElement,r=(t._self._c,t._f("subStringToCity")(t.goodsInfo.storeInfo.open_address));t.$mp.data=Object.assign({},{$root:{f0:r}})},o=[];r.d(e,"b",function(){return n}),r.d(e,"c",function(){return o}),r.d(e,"a",function(){return a})}},[["cbd8","common/runtime","common/vendor"]]]);