(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/subscribe/tree_details/tree_details"],{1427:function(e,t,a){},"2bca":function(e,t,a){"use strict";a.r(t);var r=a("bbac"),n=a.n(r);for(var i in r)"default"!==i&&function(e){a.d(t,e,function(){return r[e]})}(i);t["default"]=n.a},"31fc":function(e,t,a){"use strict";a.r(t);var r=a("516b"),n=a("2bca");for(var i in n)"default"!==i&&function(e){a.d(t,e,function(){return n[e]})}(i);a("9b95");var s,o=a("f0c5"),u=Object(o["a"])(n["default"],r["b"],r["c"],!1,null,"09d84005",null,!1,r["a"],s);t["default"]=u.exports},"516b":function(e,t,a){"use strict";var r,n=function(){var e=this,t=e.$createElement,a=(e._self._c,e._f("subStringToCity")(e.goodsInfo.storeInfo.open_address));e.$mp.data=Object.assign({},{$root:{f0:a}})},i=[];a.d(t,"b",function(){return n}),a.d(t,"c",function(){return i}),a.d(t,"a",function(){return r})},"9b95":function(e,t,a){"use strict";var r=a("1427"),n=a.n(r);n.a},bbac:function(e,t,a){"use strict";(function(e,r){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i(a("a34a"));function i(e){return e&&e.__esModule?e:{default:e}}function s(e,t,a,r,n,i,s){try{var o=e[i](s),u=o.value}catch(d){return void a(d)}o.done?t(u):Promise.resolve(u).then(r,n)}function o(e){return function(){var t=this,a=arguments;return new Promise(function(r,n){var i=e.apply(t,a);function o(e){s(i,r,n,o,u,"next",e)}function u(e){s(i,r,n,o,u,"throw",e)}o(void 0)})}}var u={data:function(){return{StatusAddNav:this.StatusAddNav,StatusAddHalfNav:this.StatusAddHalfNav,opacityNum:0,currentGoodsId:0,goodsInfo:{},cartInfo:{},orderKey:"",defaultAddress:{},providerList:[],orderId:"",id:""}},onPageScroll:function(t){e("log",t," at pages\\subscribe\\tree_details\\tree_details.vue:76"),this.opacityNum=t.scrollTop>50?1:0},onLoad:function(t){var a=this;this.currentGoodsId=t.id,this.getTreeInfo(),r.getProvider({service:"payment",success:function(t){e("log","payment success:"+JSON.stringify(t)," at pages\\subscribe\\tree_details\\tree_details.vue:86");var r=[];t.provider.map(function(e){switch(e){case"alipay":r.push({name:"支付宝",id:e,loading:!1});break;case"wxpay":r.push({name:"微信",id:e,loading:!1});break;default:break}}),a.providerList=r},fail:function(t){e("log","获取支付通道失败：",t," at pages\\subscribe\\tree_details\\tree_details.vue:111")}})},methods:{updatePayStatus:function(){var t=this;t.baseGet(t.U({c:"store_api",a:"update_pay_status",q:{order_id:t.orderId,product_id:t.currentGoodsId,id:t.id}}),function(t){e("log",t," at pages\\subscribe\\tree_details\\tree_details.vue:131")},function(t){e("log",t," at pages\\subscribe\\tree_details\\tree_details.vue:134")},!0)},requestPayment:function(){var t=o(n.default.mark(function t(){var a,i=this;return n.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e("log","uni-支付宝"," at pages\\subscribe\\tree_details\\tree_details.vue:140"),this.providerList[0].loading=!0,t.next=4,this.getOrderInfo_uniapp(this.providerList[0].id);case 4:if(a=t.sent,e("log","得到订单信息",a," at pages\\subscribe\\tree_details\\tree_details.vue:143"),200===a.statusCode){t.next=10;break}return e("log","获得订单信息失败",a," at pages\\subscribe\\tree_details\\tree_details.vue:145"),r.showModal({content:"获得订单信息失败",showCancel:!1}),t.abrupt("return");case 10:r.requestPayment({provider:this.providerList[0].id,orderInfo:a.data,success:function(t){e("log","success",t," at pages\\subscribe\\tree_details\\tree_details.vue:156"),r.showToast({title:"感谢您的赞助!"})},fail:function(t){e("log","fail",t," at pages\\subscribe\\tree_details\\tree_details.vue:162"),r.showModal({content:"支付失败,原因为: "+t.errMsg,showCancel:!1}),that.updatePayStatus()},complete:function(){i.providerList[0].loading=!1}});case 11:case"end":return t.stop()}},t,this)}));function a(){return t.apply(this,arguments)}return a}(),getOrderInfo_uniapp:function(t){var a="";a=plus.runtime.appid;var n="https://demo.dcloud.net.cn/payment/?payid="+t+"&appid="+a+"&total=0.1";return e("log",n," at pages\\subscribe\\tree_details\\tree_details.vue:182"),new Promise(function(e){r.request({url:n,success:function(t){e(t)},fail:function(t){e(t)}})})},SortData:function(e){for(var t={},a=[],r=0;r<e.length;r++){var n=e[r];if(t[n.mer_id])for(var i=0;i<a.length;i++){var s=a[i];if(s.mer_id==n.mer_id){s.count_price+=n.productInfo.price*n.cart_num,s.count_num+=n.cart_num,s.data.push(n);break}}else a.push({count_price:n.productInfo.price*n.cart_num,count_num:n.cart_num,mer_id:n.mer_id,data:[n]}),t[n.mer_id]="Occupies a position"}return a},settlement:function(){var t=this;t.basePost(t.U({c:"auth_api",a:"create_order"}),{mer_id:t.cartInfo[0].mer_id,key:t.orderKey,couponId:"",userIntegral:"",mark:"",type:2,product_id:t.cartInfo[0].data[0].productInfo.id},function(e){t.orderId=e.data.result.orderId,t.id=e.data.result.id;e.data.result.orderId,t.sumPrice;t.updatePayStatus(),t.requestPayment()},function(t){e("log",t," at pages\\subscribe\\tree_details\\tree_details.vue:272")})},getOrderInfo:function(t){var a=this;a.basePost(a.U({c:"auth_api",a:"confirm_order"}),{cartId:t},function(t){e("log",t," at pages\\subscribe\\tree_details\\tree_details.vue:285"),a.cartInfo=a.SortData(t.data.cartInfo),a.orderKey=t.data.orderKey,a.settlement()},function(t){e("log",t," at pages\\subscribe\\tree_details\\tree_details.vue:291")})},purchase:function(){var e=this;e.isLogin(),e.baseGet(e.U({c:"auth_api",a:"now_buy",q:{productId:e.goodsInfo.storeInfo.id,merId:e.goodsInfo.merInfo.id,cartNum:1}}),function(t){e.getOrderInfo(t.data.cartId)},function(t){-1!=t.msg.indexOf("该产品库存不足")&&e.Tips({title:t.msg})},!0)},getTreeInfo:function(){var t=this;t.baseGet(t.U({c:"store_api",a:"details",q:{id:t.currentGoodsId}}),function(a){t.goodsInfo=a.data,e("log",t.goodsInfo," at pages\\subscribe\\tree_details\\tree_details.vue:333")},function(t){e("log",t," at pages\\subscribe\\tree_details\\tree_details.vue:336")},!0)},navToBack:function(){r.navigateBack({delta:1})}}};t.default=u}).call(this,a("0de9")["default"],a("6e42")["default"])},cbd8:function(e,t,a){"use strict";(function(e){a("7a84"),a("921b");r(a("66fd"));var t=r(a("31fc"));function r(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,a("6e42")["createPage"])}},[["cbd8","common/runtime","common/vendor"]]]);