(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/subscribe/exchange_confirm/exchange_confirm"],{"0452":function(e,r,t){"use strict";var n=t("8127"),a=t.n(n);a.a},"0863":function(e,r,t){"use strict";t.r(r);var n=t("bb70"),a=t("ffd9");for(var i in a)"default"!==i&&function(e){t.d(r,e,function(){return a[e]})}(i);t("0452");var c,o=t("f0c5"),u=Object(o["a"])(a["default"],n["b"],n["c"],!1,null,"42c2a665",null,!1,n["a"],c);r["default"]=u.exports},8127:function(e,r,t){},bb70:function(e,r,t){"use strict";var n,a=function(){var e=this,r=e.$createElement;e._self._c},i=[];t.d(r,"b",function(){return a}),t.d(r,"c",function(){return i}),t.d(r,"a",function(){return n})},cc01:function(e,r,t){"use strict";(function(e,n){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var a=i(t("a34a"));function i(e){return e&&e.__esModule?e:{default:e}}function c(e,r,t,n,a,i,c){try{var o=e[i](c),u=o.value}catch(s){return void t(s)}o.done?r(u):Promise.resolve(u).then(n,a)}function o(e){return function(){var r=this,t=arguments;return new Promise(function(n,a){var i=e.apply(r,t);function o(e){c(i,n,a,o,u,"next",e)}function u(e){c(i,n,a,o,u,"throw",e)}o(void 0)})}}var u={data:function(){return{priceGroup:{},payModalFlag:!1,array:[{coupon_title:"未选择",coupon_price:0}],currentCouponPrice:0,couponIndex:0,listId:"",cartInfo:[],defaultAddress:{city:"",detail:"",district:"",id:"",is_default:"",phone:"",province:"",real_name:""},createOrder:{addressId:"",couponId:"",userIntegral:"",mark:""},orderKey:"",mer_id:0,providerList:[],orderId:"",id:"",productId:""}},onLoad:function(r){var t=this;this.listId=r.listId,this.getAddressList(),this.getOrderInfo(),e.getProvider({service:"payment",success:function(e){n("log","payment success:"+JSON.stringify(e)," at pages\\subscribe\\exchange_confirm\\exchange_confirm.vue:211");var r=[];e.provider.map(function(e){switch(e){case"alipay":r.push({name:"支付宝",id:e,loading:!1});break;case"wxpay":r.push({name:"微信",id:e,loading:!1});break;default:break}}),t.providerList=r},fail:function(e){n("log","获取支付通道失败：",e," at pages\\subscribe\\exchange_confirm\\exchange_confirm.vue:236")}})},computed:{sumNum:function(){for(var e=0,r=0;r<this.cartInfo.length;r++)e+=parseInt(this.cartInfo[r].count_num);return e},sumPrice:function(){for(var e=0,r=0;r<this.cartInfo.length;r++)e+=this.cartInfo[r].count_price;return parseFloat(e+"")}},methods:{updatePayStatus:function(){var e=this;e.baseGet(e.U({c:"store_api",a:"exchange_update_pay_status",q:{order_id:e.orderId,product_id:e.productId}}),function(e){n("log",e," at pages\\subscribe\\exchange_confirm\\exchange_confirm.vue:273")},function(e){n("log",e," at pages\\subscribe\\exchange_confirm\\exchange_confirm.vue:276")},!0)},payMoney:function(){var r=this;r.basePost(r.U({c:"pay",a:"pay"}),{reqsn:r.orderId,sumPrice:r.sumPrice,paytype:"A03"},function(t){e.showToast({title:t.data.errmsg,icon:"none"}),r.hideOrOpenModal()},function(e){n("log",e," at pages\\subscribe\\exchange_confirm\\exchange_confirm.vue:300")})},hideOrOpenModal:function(){this.payModalFlag=!1,e.redirectTo({url:"/pages/user/order_details/order_details?order_id="+this.orderId})},getAddressList:function(){var e=this;e.basePost(e.U({c:"user_api",a:"user_default_address"}),{},function(r){e.defaultAddress=r.data},function(e){n("log",e," at pages\\subscribe\\exchange_confirm\\exchange_confirm.vue:322")})},SortData:function(e){for(var r={},t=[],n=0;n<e.length;n++){var a=e[n];if(r[a.mer_id])for(var i=0;i<t.length;i++){var c=t[i];if(c.mer_id==a.mer_id){c.count_price+=a.productInfo.price*a.cart_num,c.count_num+=a.cart_num,c.data.push(a);break}}else t.push({count_price:a.productInfo.price*a.cart_num,count_num:a.cart_num,mer_id:a.mer_id,data:[a]}),r[a.mer_id]="Occupies a position"}return t},getOrderInfo:function(){var e=this;e.basePost(e.U({c:"auth_api",a:"confirm_order"}),{cartId:e.listId,type:3},function(r){e.cartInfo=e.SortData(r.data.cartInfo),e.orderKey=r.data.orderKey,e.priceGroup=r.data.priceGroup,e.productId=r.data.cartInfo[0].product_id},function(e){n("log",e," at pages\\subscribe\\exchange_confirm\\exchange_confirm.vue:370")})},bindPickerChange:function(e){this.couponIndex=e.detail.value,this.sumPrice+=this.currentCouponPrice,this.sumPrice-=this.array[e.detail.value].coupon_price,this.currentCouponPrice=this.array[e.detail.value].coupon_price},address:function(){e.navigateTo({url:"/pages/user/admin_address/admin_address?clickFlag=1"})},settlement:function(){var r=this;r.basePost(r.U({c:"auth_api",a:"create_order"}),{mer_id:r.cartInfo[0].mer_id,key:r.orderKey,addressId:r.defaultAddress.id,couponId:r.array[r.couponIndex].id,userIntegral:r.createOrder.userIntegral,mark:r.createOrder.mark,type:3},function(e){r.orderId=e.data.result.orderId,r.payModalFlag=!0,r.id=e.data.result.id,r.updatePayStatus()},function(r){e.showToast({title:r.msg,icon:"none"})})},requestPayment:function(){var r=o(a.default.mark(function r(t,i){var c,o=this;return a.default.wrap(function(r){while(1)switch(r.prev=r.next){case 0:return this.providerList[i].loading=!0,r.next=3,this.getOrderInfo_uniapp(t.id);case 3:if(c=r.sent,n("log","得到订单信息",c," at pages\\subscribe\\exchange_confirm\\exchange_confirm.vue:427"),200===c.statusCode){r.next=9;break}return n("log","获得订单信息失败",c," at pages\\subscribe\\exchange_confirm\\exchange_confirm.vue:429"),e.showModal({content:"获得订单信息失败",showCancel:!1}),r.abrupt("return");case 9:e.requestPayment({provider:t.id,orderInfo:c.data,success:function(r){n("log","success",r," at pages\\subscribe\\exchange_confirm\\exchange_confirm.vue:440"),e.showToast({title:"感谢您的赞助!"})},fail:function(r){n("log","fail",r," at pages\\subscribe\\exchange_confirm\\exchange_confirm.vue:446"),e.showModal({content:"支付失败,原因为: "+r.errMsg,showCancel:!1})},complete:function(){o.providerList[i].loading=!1}});case 10:case"end":return r.stop()}},r,this)}));function t(e,t){return r.apply(this,arguments)}return t}(),getOrderInfo_uniapp:function(r){var t="";t=plus.runtime.appid;var a="https://demo.dcloud.net.cn/payment/?payid="+r+"&appid="+t+"&total=0.1";return n("log",a," at pages\\subscribe\\exchange_confirm\\exchange_confirm.vue:463"),new Promise(function(r){e.request({url:a,success:function(e){r(e)},fail:function(e){r(e)}})})}}};r.default=u}).call(this,t("6e42")["default"],t("0de9")["default"])},ef17:function(e,r,t){"use strict";(function(e){t("7a84"),t("921b");n(t("66fd"));var r=n(t("0863"));function n(e){return e&&e.__esModule?e:{default:e}}e(r.default)}).call(this,t("6e42")["createPage"])},ffd9:function(e,r,t){"use strict";t.r(r);var n=t("cc01"),a=t.n(n);for(var i in n)"default"!==i&&function(e){t.d(r,e,function(){return n[e]})}(i);r["default"]=a.a}},[["ef17","common/runtime","common/vendor"]]]);