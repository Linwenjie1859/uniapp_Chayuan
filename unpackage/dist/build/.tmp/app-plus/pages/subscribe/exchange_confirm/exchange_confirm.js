(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/subscribe/exchange_confirm/exchange_confirm"],{"0863":function(e,t,r){"use strict";r.r(t);var n=r("d7a0"),a=r("ffd9");for(var i in a)"default"!==i&&function(e){r.d(t,e,function(){return a[e]})}(i);r("1103");var o,c=r("f0c5"),u=Object(c["a"])(a["default"],n["b"],n["c"],!1,null,"ec5f270a",null,!1,n["a"],o);t["default"]=u.exports},1103:function(e,t,r){"use strict";var n=r("ae74"),a=r.n(n);a.a},ae74:function(e,t,r){},cc01:function(e,t,r){"use strict";(function(e,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(r("a34a"));function i(e){return e&&e.__esModule?e:{default:e}}function o(e,t,r,n,a,i,o){try{var c=e[i](o),u=c.value}catch(s){return void r(s)}c.done?t(u):Promise.resolve(u).then(n,a)}function c(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var i=e.apply(t,r);function c(e){o(i,n,a,c,u,"next",e)}function u(e){o(i,n,a,c,u,"throw",e)}c(void 0)})}}var u={data:function(){return{priceGroup:{},payModalFlag:!1,array:[{coupon_title:"未选择",coupon_price:0}],currentCouponPrice:0,couponIndex:0,listId:"",cartInfo:[],defaultAddress:{city:"",detail:"",district:"",id:"",is_default:"",phone:"",province:"",real_name:""},createOrder:{addressId:"",couponId:"",userIntegral:"",mark:""},orderKey:"",mer_id:0,providerList:[],orderId:"",id:"",productId:""}},onLoad:function(t){var r=this;this.listId=t.listId,this.getAddressList(),this.getOrderInfo(),e.getProvider({service:"payment",success:function(e){n("log","payment success:"+JSON.stringify(e)," at pages\\subscribe\\exchange_confirm\\exchange_confirm.vue:211");var t=[];e.provider.map(function(e){switch(e){case"alipay":t.push({name:"支付宝",id:e,loading:!1});break;case"wxpay":t.push({name:"微信",id:e,loading:!1});break;default:break}}),r.providerList=t},fail:function(e){n("log","获取支付通道失败：",e," at pages\\subscribe\\exchange_confirm\\exchange_confirm.vue:236")}})},computed:{sumNum:function(){for(var e=0,t=0;t<this.cartInfo.length;t++)e+=parseInt(this.cartInfo[t].count_num);return e},sumPrice:function(){for(var e=0,t=0;t<this.cartInfo.length;t++)e+=this.cartInfo[t].count_price;return parseFloat(e+"")}},methods:{updatePayStatus:function(){var e=this;e.baseGet(e.U({c:"store_api",a:"exchange_update_pay_status",q:{order_id:e.orderId,product_id:e.productId}}),function(e){n("log",e," at pages\\subscribe\\exchange_confirm\\exchange_confirm.vue:273")},function(e){n("log",e," at pages\\subscribe\\exchange_confirm\\exchange_confirm.vue:276")},!0)},payMoney:function(){var t=this;t.basePost(t.U({c:"pay",a:"pay"}),{reqsn:t.orderId,sumPrice:t.sumPrice,paytype:"A03"},function(r){e.showToast({title:r.data.errmsg,icon:"none"}),t.hideOrOpenModal()},function(e){n("log",e," at pages\\subscribe\\exchange_confirm\\exchange_confirm.vue:300")})},hideOrOpenModal:function(){this.payModalFlag=!1,e.redirectTo({url:"/pages/user/order_details/order_details?order_id="+this.orderId})},getAddressList:function(){var e=this;e.basePost(e.U({c:"user_api",a:"user_default_address"}),{},function(t){e.defaultAddress=t.data},function(e){n("log",e," at pages\\subscribe\\exchange_confirm\\exchange_confirm.vue:322")})},SortData:function(e){for(var t={},r=[],n=0;n<e.length;n++){var a=e[n];if(t[a.mer_id])for(var i=0;i<r.length;i++){var o=r[i];if(o.mer_id==a.mer_id){o.count_price+=a.productInfo.price*a.cart_num,o.count_num+=a.cart_num,o.data.push(a);break}}else r.push({count_price:a.productInfo.price*a.cart_num,count_num:a.cart_num,mer_id:a.mer_id,data:[a]}),t[a.mer_id]="Occupies a position"}return r},getOrderInfo:function(){var e=this;e.basePost(e.U({c:"auth_api",a:"confirm_order"}),{cartId:e.listId,type:3},function(t){e.cartInfo=e.SortData(t.data.cartInfo),e.orderKey=t.data.orderKey,e.priceGroup=t.data.priceGroup,e.productId=t.data.cartInfo[0].product_id},function(e){n("log",e," at pages\\subscribe\\exchange_confirm\\exchange_confirm.vue:370")})},bindPickerChange:function(e){this.couponIndex=e.detail.value,this.sumPrice+=this.currentCouponPrice,this.sumPrice-=this.array[e.detail.value].coupon_price,this.currentCouponPrice=this.array[e.detail.value].coupon_price},address:function(){e.navigateTo({url:"/pages/user/admin_address/admin_address?clickFlag=1"})},settlement:function(){var t=this;t.basePost(t.U({c:"auth_api",a:"create_order"}),{mer_id:t.cartInfo[0].mer_id,key:t.orderKey,addressId:t.defaultAddress.id,couponId:t.array[t.couponIndex].id,userIntegral:t.createOrder.userIntegral,mark:t.createOrder.mark,type:3},function(e){t.orderId=e.data.result.orderId,t.id=e.data.result.id,t.updatePayStatus(),t.requestPayment()},function(t){e.showToast({title:t.msg,icon:"none"})})},requestPayment:function(){var t=c(a.default.mark(function t(){var r,i=this;return a.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.providerList[0].loading=!0,t.next=3,this.getOrderInfo_uniapp(this.providerList[0].id);case 3:if(r=t.sent,200===r.statusCode){t.next=8;break}return n("log","获得订单信息失败",r," at pages\\subscribe\\exchange_confirm\\exchange_confirm.vue:429"),e.showModal({content:"获得订单信息失败",showCancel:!1}),t.abrupt("return");case 8:e.requestPayment({provider:this.providerList[0].id,orderInfo:r.data,success:function(t){e.showToast({title:"感谢您的赞助!"})},fail:function(t){e.showModal({content:"支付失败,原因为: "+t.errMsg,showCancel:!1})},complete:function(){i.providerList[1].loading=!1}});case 9:case"end":return t.stop()}},t,this)}));function r(){return t.apply(this,arguments)}return r}(),getOrderInfo_uniapp:function(t){var r="";r=plus.runtime.appid;var n="https://demo.dcloud.net.cn/payment/?payid="+t+"&appid="+r+"&total=0.1";return new Promise(function(t){e.request({url:n,success:function(e){t(e)},fail:function(e){t(e)}})})}}};t.default=u}).call(this,r("6e42")["default"],r("0de9")["default"])},d7a0:function(e,t,r){"use strict";var n,a=function(){var e=this,t=e.$createElement;e._self._c},i=[];r.d(t,"b",function(){return a}),r.d(t,"c",function(){return i}),r.d(t,"a",function(){return n})},ef17:function(e,t,r){"use strict";(function(e){r("7a84"),r("921b");n(r("66fd"));var t=n(r("0863"));function n(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,r("6e42")["createPage"])},ffd9:function(e,t,r){"use strict";r.r(t);var n=r("cc01"),a=r.n(n);for(var i in n)"default"!==i&&function(e){r.d(t,e,function(){return n[e]})}(i);t["default"]=a.a}},[["ef17","common/runtime","common/vendor"]]]);