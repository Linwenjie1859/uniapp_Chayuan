(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/subscribe/exchange_confirm/exchange_confirm"],{"0452":function(t,e,r){"use strict";var n=r("8127"),o=r.n(n);o.a},"0863":function(t,e,r){"use strict";r.r(e);var n=r("bb70"),o=r("ffd9");for(var a in o)"default"!==a&&function(t){r.d(e,t,function(){return o[t]})}(a);r("0452");var i,c=r("f0c5"),u=Object(c["a"])(o["default"],n["b"],n["c"],!1,null,"42c2a665",null,!1,n["a"],i);e["default"]=u.exports},8127:function(t,e,r){},bb70:function(t,e,r){"use strict";var n,o=function(){var t=this,e=t.$createElement;t._self._c},a=[];r.d(e,"b",function(){return o}),r.d(e,"c",function(){return a}),r.d(e,"a",function(){return n})},cc01:function(t,e,r){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=o(r("a34a"));function o(t){return t&&t.__esModule?t:{default:t}}function a(t,e,r,n,o,a,i){try{var c=t[a](i),u=c.value}catch(d){return void r(d)}c.done?e(u):Promise.resolve(u).then(n,o)}function i(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function c(t){a(i,n,o,c,u,"next",t)}function u(t){a(i,n,o,c,u,"throw",t)}c(void 0)})}}var c={data:function(){return{priceGroup:{},payModalFlag:!1,array:[{coupon_title:"未选择",coupon_price:0}],currentCouponPrice:0,couponIndex:0,listId:"",cartInfo:[],defaultAddress:{city:"",detail:"",district:"",id:"",is_default:"",phone:"",province:"",real_name:""},createOrder:{addressId:"",couponId:"",userIntegral:"",mark:""},orderKey:"",mer_id:0,providerList:[],orderId:"",id:"",productId:""}},onLoad:function(t){this.listId=t.listId,this.getAddressList(),this.getOrderInfo()},computed:{sumNum:function(){for(var t=0,e=0;e<this.cartInfo.length;e++)t+=parseInt(this.cartInfo[e].count_num);return t},sumPrice:function(){for(var t=0,e=0;e<this.cartInfo.length;e++)t+=this.cartInfo[e].count_price;return parseFloat(t+"")}},methods:{updatePayStatus:function(){var t=this;t.baseGet(t.U({c:"store_api",a:"exchange_update_pay_status",q:{order_id:t.orderId,product_id:t.productId}}),function(t){console.log(t)},function(t){console.log(t)},!0)},payMoney:function(){var e=this;e.basePost(e.U({c:"pay",a:"pay"}),{reqsn:e.orderId,sumPrice:e.sumPrice,paytype:"A03"},function(r){t.showToast({title:r.data.errmsg,icon:"none"}),e.hideOrOpenModal()},function(t){console.log(t)})},hideOrOpenModal:function(){this.payModalFlag=!1,t.redirectTo({url:"/pages/user/order_details/order_details?order_id="+this.orderId})},getAddressList:function(){var t=this;t.basePost(t.U({c:"user_api",a:"user_default_address"}),{},function(e){t.defaultAddress=e.data},function(t){console.log(t)})},SortData:function(t){for(var e={},r=[],n=0;n<t.length;n++){var o=t[n];if(e[o.mer_id])for(var a=0;a<r.length;a++){var i=r[a];if(i.mer_id==o.mer_id){i.count_price+=o.productInfo.price*o.cart_num,i.count_num+=o.cart_num,i.data.push(o);break}}else r.push({count_price:o.productInfo.price*o.cart_num,count_num:o.cart_num,mer_id:o.mer_id,data:[o]}),e[o.mer_id]="Occupies a position"}return r},getOrderInfo:function(){var t=this;t.basePost(t.U({c:"auth_api",a:"confirm_order"}),{cartId:t.listId,type:3},function(e){t.cartInfo=t.SortData(e.data.cartInfo),t.orderKey=e.data.orderKey,t.priceGroup=e.data.priceGroup,t.productId=e.data.cartInfo[0].product_id},function(t){console.log(t)})},bindPickerChange:function(t){this.couponIndex=t.detail.value,this.sumPrice+=this.currentCouponPrice,this.sumPrice-=this.array[t.detail.value].coupon_price,this.currentCouponPrice=this.array[t.detail.value].coupon_price},address:function(){t.navigateTo({url:"/pages/user/admin_address/admin_address?clickFlag=1"})},settlement:function(){var e=this;e.basePost(e.U({c:"auth_api",a:"create_order"}),{mer_id:e.cartInfo[0].mer_id,key:e.orderKey,addressId:e.defaultAddress.id,couponId:e.array[e.couponIndex].id,userIntegral:e.createOrder.userIntegral,mark:e.createOrder.mark,type:3},function(t){e.orderId=t.data.result.orderId,e.payModalFlag=!0,e.id=t.data.result.id,e.updatePayStatus()},function(e){t.showToast({title:e.msg,icon:"none"})})},requestPayment:function(){var e=i(n.default.mark(function e(r,o){var a,i=this;return n.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.providerList[o].loading=!0,e.next=3,this.getOrderInfo_uniapp(r.id);case 3:if(a=e.sent,console.log("得到订单信息",a),200===a.statusCode){e.next=9;break}return console.log("获得订单信息失败",a),t.showModal({content:"获得订单信息失败",showCancel:!1}),e.abrupt("return");case 9:t.requestPayment({provider:r.id,orderInfo:a.data,success:function(e){console.log("success",e),t.showToast({title:"感谢您的赞助!"})},fail:function(e){console.log("fail",e),t.showModal({content:"支付失败,原因为: "+e.errMsg,showCancel:!1})},complete:function(){i.providerList[o].loading=!1}});case 10:case"end":return e.stop()}},e,this)}));function r(t,r){return e.apply(this,arguments)}return r}(),getOrderInfo_uniapp:function(e){var r="",n="https://demo.dcloud.net.cn/payment/?payid="+e+"&appid="+r+"&total=0.1";return console.log(n),new Promise(function(e){t.request({url:n,success:function(t){e(t)},fail:function(t){e(t)}})})}}};e.default=c}).call(this,r("543d")["default"])},ef17:function(t,e,r){"use strict";(function(t){r("7a84"),r("921b");n(r("66fd"));var e=n(r("0863"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,r("543d")["createPage"])},ffd9:function(t,e,r){"use strict";r.r(e);var n=r("cc01"),o=r.n(n);for(var a in n)"default"!==a&&function(t){r.d(e,t,function(){return n[t]})}(a);e["default"]=o.a}},[["ef17","common/runtime","common/vendor"]]]);