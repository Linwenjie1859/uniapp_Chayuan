(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/subscribe/tree_details/tree_details"],{1061:function(t,e,n){},"2bca":function(t,e,n){"use strict";n.r(e);var o=n("bbac"),r=n.n(o);for(var a in o)"default"!==a&&function(t){n.d(e,t,function(){return o[t]})}(a);e["default"]=r.a},"31fc":function(t,e,n){"use strict";n.r(e);var o=n("8e87"),r=n("2bca");for(var a in r)"default"!==a&&function(t){n.d(e,t,function(){return r[t]})}(a);n("e072");var i,c=n("f0c5"),s=Object(c["a"])(r["default"],o["b"],o["c"],!1,null,"1f6b7c26",null,!1,o["a"],i);e["default"]=s.exports},"8e87":function(t,e,n){"use strict";var o,r=function(){var t=this,e=t.$createElement,n=(t._self._c,t._f("subStringToCity")(t.goodsInfo.storeInfo.open_address));t.$mp.data=Object.assign({},{$root:{f0:n}})},a=[];n.d(e,"b",function(){return r}),n.d(e,"c",function(){return a}),n.d(e,"a",function(){return o})},bbac:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=r(n("a34a"));function r(t){return t&&t.__esModule?t:{default:t}}function a(t,e,n,o,r,a,i){try{var c=t[a](i),s=c.value}catch(u){return void n(u)}c.done?e(s):Promise.resolve(s).then(o,r)}function i(t){return function(){var e=this,n=arguments;return new Promise(function(o,r){var i=t.apply(e,n);function c(t){a(i,o,r,c,s,"next",t)}function s(t){a(i,o,r,c,s,"throw",t)}c(void 0)})}}var c={data:function(){return{StatusAddNav:this.StatusAddNav,StatusAddHalfNav:this.StatusAddHalfNav,opacityNum:0,currentGoodsId:0,goodsInfo:{},cartInfo:{},orderKey:"",defaultAddress:{},providerList:[],orderId:""}},onPageScroll:function(t){console.log(t),this.opacityNum=t.scrollTop>50?1:0},onLoad:function(t){this.currentGoodsId=t.id,this.getTreeInfo(),this.getAddressList()},methods:{requestPayment:function(){var e=i(o.default.mark(function e(){var n,r=this;return o.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return console.log("uni-支付宝"),this.providerList[0].loading=!0,e.next=4,this.getOrderInfo_uniapp(this.providerList[0].id);case 4:if(n=e.sent,console.log("得到订单信息",n),200===n.statusCode){e.next=10;break}return console.log("获得订单信息失败",n),t.showModal({content:"获得订单信息失败",showCancel:!1}),e.abrupt("return");case 10:t.requestPayment({provider:this.providerList[0].id,orderInfo:n.data,success:function(e){console.log("success",e),t.showToast({title:"感谢您的赞助!"})},fail:function(e){console.log("fail",e),t.showModal({content:"支付失败,原因为: "+e.errMsg,showCancel:!1})},complete:function(){r.providerList[0].loading=!1}});case 11:case"end":return e.stop()}},e,this)}));function n(){return e.apply(this,arguments)}return n}(),getOrderInfo_uniapp:function(e){var n="",o="https://demo.dcloud.net.cn/payment/?payid="+e+"&appid="+n+"&total=0.1";return console.log(o),new Promise(function(e){t.request({url:o,success:function(t){e(t)},fail:function(t){e(t)}})})},SortData:function(t){for(var e={},n=[],o=0;o<t.length;o++){var r=t[o];if(e[r.mer_id])for(var a=0;a<n.length;a++){var i=n[a];if(i.mer_id==r.mer_id){i.count_price+=r.productInfo.price*r.cart_num,i.count_num+=r.cart_num,i.data.push(r);break}}else n.push({count_price:r.productInfo.price*r.cart_num,count_num:r.cart_num,mer_id:r.mer_id,data:[r]}),e[r.mer_id]="Occupies a position"}return n},getAddressList:function(){var t=this;t.basePost(t.U({c:"user_api",a:"user_default_address"}),{},function(e){t.defaultAddress=e.data},function(t){console.log(t)})},settlement:function(){var e=this;e.basePost(e.U({c:"auth_api",a:"create_order"}),{mer_id:e.cartInfo[0].mer_id,key:e.orderKey,addressId:e.defaultAddress.id,couponId:"",userIntegral:"",mark:"",type:2},function(n){e.orderId=n.data.result.orderId;var o={order_id:n.data.result.orderId,total_price:e.sumPrice};t.redirectTo({url:"/pages/user/confirm_payment/confirm_payment?orderInfo="+JSON.stringify(o)})},function(t){console.log(t)})},getOrderInfo:function(t){var e=this;e.basePost(e.U({c:"auth_api",a:"confirm_order"}),{cartId:t},function(t){console.log(t),e.cartInfo=e.SortData(t.data.cartInfo),e.orderKey=t.data.orderKey,e.settlement()},function(t){console.log(t)})},purchase:function(){var t=this;t.baseGet(t.U({c:"auth_api",a:"now_buy",q:{productId:t.goodsInfo.storeInfo.id,merId:t.goodsInfo.merInfo.id,cartNum:1}}),function(e){t.getOrderInfo(e.data.cartId)},function(e){-1!=e.msg.indexOf("该产品库存不足")&&t.Tips({title:e.msg})},!0)},getTreeInfo:function(){var t=this;t.baseGet(t.U({c:"store_api",a:"details",q:{id:t.currentGoodsId}}),function(e){t.goodsInfo=e.data,console.log(t.goodsInfo)},function(t){console.log(t)},!0)},navToBack:function(){t.navigateBack({delta:1})}}};e.default=c}).call(this,n("543d")["default"])},cbd8:function(t,e,n){"use strict";(function(t){n("7a84"),n("921b");o(n("66fd"));var e=o(n("31fc"));function o(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("543d")["createPage"])},e072:function(t,e,n){"use strict";var o=n("1061"),r=n.n(o);r.a}},[["cbd8","common/runtime","common/vendor"]]]);