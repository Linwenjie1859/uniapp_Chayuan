(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/user/confirm_order/confirm_order"],{"270d":function(e,t,r){"use strict";var n,o=function(){var e=this,t=e.$createElement;e._self._c},a=[];r.d(t,"b",function(){return o}),r.d(t,"c",function(){return a}),r.d(t,"a",function(){return n})},"3e91":function(e,t,r){},"47ef":function(e,t,r){"use strict";r.r(t);var n=r("270d"),o=r("c78d");for(var a in o)"default"!==a&&function(e){r.d(t,e,function(){return o[e]})}(a);r("f9cb");var i,c=r("f0c5"),u=Object(c["a"])(o["default"],n["b"],n["c"],!1,null,"1f3c4765",null,!1,n["a"],i);t["default"]=u.exports},bf19:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=o(r("a34a"));function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t,r,n,o,a,i){try{var c=e[a](i),u=c.value}catch(s){return void r(s)}c.done?t(u):Promise.resolve(u).then(n,o)}function i(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var i=e.apply(t,r);function c(e){a(i,n,o,c,u,"next",e)}function u(e){a(i,n,o,c,u,"throw",e)}c(void 0)})}}function c(e){return d(e)||s(e)||u()}function u(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function s(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function d(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}var f={data:function(){return{orderId:"",payModalFlag:!1,array:[{coupon_title:"未选择",coupon_price:0}],currentCouponPrice:0,couponIndex:0,listId:"",cartInfo:[],defaultAddress:{city:"",detail:"",district:"",id:"",is_default:"",phone:"",province:"",real_name:""},createOrder:{addressId:"",couponId:"",userIntegral:"",mark:""},orderKey:"",mer_id:0,providerList:[]}},onLoad:function(e){this.listId=e.listId,this.getAddressList(),this.getOrderInfo()},computed:{sumNum:function(){for(var e=0,t=0;t<this.cartInfo.length;t++)e+=parseInt(this.cartInfo[t].count_num);return e},sumPrice:function(){for(var e=0,t=0;t<this.cartInfo.length;t++)e+=this.cartInfo[t].count_price;return parseFloat(e+"")}},methods:{payMoney:function(){var t=this;t.basePost(t.U({c:"pay",a:"pay"}),{reqsn:t.orderId,sumPrice:t.sumPrice,paytype:"A03"},function(r){e.showToast({title:r.data.errmsg,icon:"none"}),t.hideOrOpenModal()},function(e){console.log(e)})},hideOrOpenModal:function(){this.payModalFlag=!1,e.redirectTo({url:"/pages/user/order_details/order_details?order_id="+this.orderId})},dealData:function(e){for(var t=0;t<e.length;t++)e[t]["coupon_price"]=parseFloat(e[t].coupon_price);return e},getCanUseCoupon:function(e){var t=this;t.baseGet(t.U({c:"coupons_api",a:"get_use_coupon_order",q:{totalPrice:e}}),function(e){t.array=[].concat(c(t.array),c(t.dealData(e.data)))},function(e){console.log(e)},!0)},getAddressList:function(){var e=this;e.basePost(e.U({c:"user_api",a:"user_default_address"}),{},function(t){e.defaultAddress=t.data},function(e){console.log(e)})},SortData:function(e){for(var t={},r=[],n=0;n<e.length;n++){var o=e[n];if(t[o.mer_id])for(var a=0;a<r.length;a++){var i=r[a];if(i.mer_id==o.mer_id){i.count_price+=o.productInfo.price*o.cart_num,i.count_num+=o.cart_num,i.data.push(o);break}}else r.push({count_price:o.productInfo.price*o.cart_num,count_num:o.cart_num,mer_id:o.mer_id,data:[o]}),t[o.mer_id]="Occupies a position"}return r},getOrderInfo:function(){var e=this;e.basePost(e.U({c:"auth_api",a:"confirm_order"}),{cartId:e.listId},function(t){e.cartInfo=e.SortData(t.data.cartInfo),e.orderKey=t.data.orderKey,e.getCanUseCoupon(e.sumPrice)},function(e){console.log(e)})},bindPickerChange:function(e){this.couponIndex=e.detail.value,this.sumPrice+=this.currentCouponPrice,this.sumPrice-=this.array[e.detail.value].coupon_price,this.currentCouponPrice=this.array[e.detail.value].coupon_price},address:function(){e.navigateTo({url:"/pages/user/admin_address/admin_address?clickFlag=1"})},settlement:function(){var e=this;e.basePost(e.U({c:"auth_api",a:"create_order"}),{mer_id:e.cartInfo[0].mer_id,key:e.orderKey,addressId:e.defaultAddress.id,couponId:e.array[e.couponIndex].id,userIntegral:e.createOrder.userIntegral,mark:e.createOrder.mark,type:e.open_address?2:1},function(t){e.orderId=t.data.result.orderId,e.payModalFlag=!0},function(e){console.log(e)})},requestPayment:function(){var t=i(n.default.mark(function t(r,o){var a,i=this;return n.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.providerList[o].loading=!0,t.next=3,this.getOrderInfo_uniapp(r.id);case 3:if(a=t.sent,console.log("得到订单信息",a),200===a.statusCode){t.next=9;break}return console.log("获得订单信息失败",a),e.showModal({content:"获得订单信息失败",showCancel:!1}),t.abrupt("return");case 9:e.requestPayment({provider:r.id,orderInfo:a.data,success:function(t){console.log("success",t),e.showToast({title:"感谢您的赞助!"})},fail:function(t){console.log("fail",t),e.showModal({content:"支付失败,原因为: "+t.errMsg,showCancel:!1})},complete:function(){i.providerList[o].loading=!1}});case 10:case"end":return t.stop()}},t,this)}));function r(e,r){return t.apply(this,arguments)}return r}(),getOrderInfo_uniapp:function(t){var r="",n="https://demo.dcloud.net.cn/payment/?payid="+t+"&appid="+r+"&total=0.1";return console.log(n),new Promise(function(t){e.request({url:n,success:function(e){t(e)},fail:function(e){t(e)}})})}}};t.default=f}).call(this,r("543d")["default"])},c4b9:function(e,t,r){"use strict";(function(e){r("7a84"),r("921b");n(r("66fd"));var t=n(r("47ef"));function n(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,r("543d")["createPage"])},c78d:function(e,t,r){"use strict";r.r(t);var n=r("bf19"),o=r.n(n);for(var a in n)"default"!==a&&function(e){r.d(t,e,function(){return n[e]})}(a);t["default"]=o.a},f9cb:function(e,t,r){"use strict";var n=r("3e91"),o=r.n(n);o.a}},[["c4b9","common/runtime","common/vendor"]]]);